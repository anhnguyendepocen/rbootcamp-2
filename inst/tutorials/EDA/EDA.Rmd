---
title: "Tutorial 1: Exploratory Data Analysis"
output: 
  learnr::tutorial:
    progressive: true
runtime: shiny_prerendered
---

<script type="text/javascript" async
    src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>



## Introduction

This module provides an opportunity to put into practice many of the techniques discussed in this short course. The goal is to think through the tool(s) youâ€™ll need and use them properly to answer the questions. This case study continues to use the *Customer* data and, although not comprehensive, provides you the opportunity to perform several steps in the analytic process to include:

1. Organizing your files
2. Importing the data
3. Dealing with missing values
4. Understanding numerical and categorical variables through descriptive statistics 
5. Using visualization to understand your data

For this tutorial, I have preloaded the following packages for your use:

```{r setup, include=FALSE}
library(learnr)
library(tidyverse)
library(readxl)

knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE, collapse=TRUE)
```

```{r, eval=FALSE}
library(tidyverse)
library(readxl)
```

## Importing the Data

The first step to any data analysis process is to *get* the data. Assuming our customer data is located in an Excel file titled *CustomerData.xlsx* and located in our current working directory, how would you load it?

```{r import-question1, echo=FALSE}
quiz(caption = "Knowledge Check",
question("How would you read in the names of the spreadsheets in the CustomerData.xlsx file?",
  answer("read_excel('CustomerData.xlsx')"),
  answer("excel_sheets('CustomerData.xlsx')", correct = TRUE),
  answer("read_sheets('CustomerData.xlsx')"),
  allow_retry = TRUE,
  random_answer_order = TRUE,
  correct = "Correct! For this Excel file there are two spreadsheets:  'Metadata' and 'Data'."
),
question("Assuming you want to import the 'Data' spreadsheet from the CustomerData.xlsx file, what is the correct command?",
  answer("read_excel('CustomerData.xlsx', sheet = 'Data')", correct = TRUE),
  answer("read_excel('CustomerData.xlsx')"),
  answer("excel_sheets('CustomerData.xlsx', sheet = 'Data')"),
  answer("read_csv('CustomerData.xlsx', sheet = 'Data')"),
  allow_retry = TRUE,
  random_answer_order = TRUE
)
)
```

For the following exercises I have pre-loaded the customer data and saved it as a data frame named `customer`.  Let's get a basic feel for this `customer` data set by assessing the following:

1. What are the dimensions of this data set?
2. What are the names of all the variables?
3. What type of variables are in this data (i.e. character, integer, double)?

```{r prepare-data, echo=FALSE}
customer <- customer
```

```{r understand, exercise=TRUE, exercise.setup = "prepare-data"}

```

```{r understand-hint-1}
dim(customer)
```

```{r understand-hint-2}
names(customer)
```

```{r understand-hint-3}
# you can assess the data with glimpse
glimpse(customer)

# or by looping over each column and assessing the type
sapply(customer, typeof)
```

```{r understand-question1, echo=FALSE}
quiz(caption = "Knowledge Check",
question("What are the dimensions of our customer data?",
  answer("5000 x 60"),
  answer("5000 x 59", correct = TRUE),
  answer("5000"),
  answer("59 x 5000"),
  allow_retry = TRUE,
  random_answer_order = TRUE
),
question("What are the names of the first 3 variables?",
  answer("CustomerID, Region, TownSize", correct = TRUE),
  answer("CustomerID, Gender, Age"),
  answer("Region, Gender, Age"),
  answer("CustomerID, Region Age"),
  allow_retry = TRUE,
  random_answer_order = TRUE
),
question("What type of variable is JobCategory?",
  answer("character", correct = TRUE),
  answer("integer"),
  answer("factor"),
  answer("double"),
  allow_retry = TRUE,
  random_answer_order = TRUE
)
)
```

## Dealing with Missing Data

A common task in data analysis is dealing with missing values.  Let's assess missing values in our `customer` data set.   Go ahead and check out:

1. How many missing values are in the data?
2. Which variables contain these missing values?
3. Omit all rows with missing values in them? Now how many observations does your data have?


```{r missing, exercise=TRUE, exercise.setup = "prepare-data"}

```

```{r missing-hint-1}
sum(is.na(customer))
```

```{r missing-hint-2}
colSums(is.na(customer)) %>%
  sort(decreasing = TRUE)
```

```{r missing-hint-3}
customer <- na.omit(customer)

dim(customer)
```

```{r missing-question1, echo=FALSE}
quiz(caption = "Knowledge Check",
question("How many missing values are in this data set?",
  answer("136"),
  answer("124", correct = TRUE),
  answer("98"),
  answer("32"),
  random_answer_order = TRUE
),
question("How many variables contain missing values?",
  answer("8", correct = TRUE),
  answer("6"),
  answer("4"),
  answer("2"),
  random_answer_order = TRUE
),
question("How many missing values are in the Gender variable?",
  answer("33", correct = TRUE),
  answer("16"),
  answer("7"),
  answer("2"),
  random_answer_order = TRUE
),
question("After you remove all missing values, how many rows are in the clean data set?",
  answer("4893", correct = TRUE),
  answer("4888"),
  answer("4918"),
  answer("4617"),
  random_answer_order = TRUE
)
)
```

## Understanding Your Data Through Descriptive Statistics

Descriptive statistics are the first pieces of information used to understand and represent a data set. There goal, in essence, is to describe the main features of numerical and categorical information with simple summaries. Lets perform some descriptive statistics that will help answer the following questions:

### 1. How is average HHIncome distributed across JobCategory? 

```{r prepare-data2, echo=FALSE}
customer <- na.omit(customer)
```

```{r descriptive1, exercise=TRUE, exercise.setup = "prepare-data2"}
# fill in these functions to answer the question
customer %>%
  group_by() %>% 
  summarize() %>% 
  arrange()
```

```{r descriptive1-hint-1}
# First, we want to group our data by job category
customer %>%
  group_by(JobCategory) %>% 
  summarize() %>% 
  arrange()
```

```{r descriptive1-hint-2}
# Next, we compute our summary statistic
customer %>%
  group_by(JobCategory) %>% 
  summarize(avg_HHIncome = mean(HHIncome)) %>% 
  arrange()
```

```{r descriptive1-solution}
# Finally, we arrange our summary statistic so we can easily see how the
# job categories rank
customer %>%
  group_by(JobCategory) %>% 
  summarize(avg_HHIncome = mean(HHIncome)) %>% 
  arrange(desc(avg_HHIncome))
```

```{r descriptive-question1, echo=FALSE}
quiz(caption = "Knowledge Check",
question("Which JobCategory has the largest average HHIncome?",
  answer("Crafts"),
  answer("Labor", correct = TRUE),
  answer("Sales"),
  answer("Professional"),
  random_answer_order = TRUE
),
question("Which JobCategory has the smallest average HHIncome?",
  answer("Crafts"),
  answer("Labor"),
  answer("Sales", correct = TRUE),
  answer("Professional"),
  random_answer_order = TRUE
)
)
```


### 2. Is there a large difference in the number of customers in each JobCategory?

```{r descriptive2, exercise=TRUE, exercise.setup = "prepare-data2"}
# fill in the count function to answer the question
customer %>% 
  count()
```

```{r descriptive2-hint-1}
# We can use count to count the number of observations.
customer %>%
  count(JobCategory)
```


```{r descriptive2-solution}
# We can also include sort = TRUE to sort the output
customer %>%
  count(JobCategory, sort = TRUE)
```

```{r descriptive-question2, echo=FALSE}
quiz(caption = "Knowledge Check",
question("Which JobCategory captures the most customers?",
  answer("Crafts"),
  answer("Sales", correct = TRUE),
  answer("Labor"),
  answer("Professional"),
  random_answer_order = TRUE
),
question("How many customers are in the *Service* career field?",
  answer("1635"),
  answer("212"),
  answer("620", correct = TRUE),
  answer("452"),
  random_answer_order = TRUE
)
)
```


### 3. How many customers are in each JobCategory across the regions?

```{r descriptive3, exercise=TRUE, exercise.setup = "prepare-data2"}
# fill in the count function to answer the question
customer %>%
  count()
```


```{r descriptive3-hint-1}
# We can inspect the number of earners in each category by region with the following:
customer %>%
  count(JobCategory, Region)
```

```{r descriptive3-hint-2}
# by sorting we can get the categories and regions with the most customers
customer %>%
  count(JobCategory, Region, sort = TRUE)
```

```{r descriptive3-hint-3}
# and we can add arrange to identify the categories and regions with the least 
# customers
customer %>%
  count(JobCategory, Region) %>%
  arrange(n)
```

```{r descriptive-question3, echo=FALSE}
quiz(caption = "Knowledge Check",
question("Which JobCategory and Region captures the most customers?",
  answer("Sales in region 4"),
  answer("Sales in region 5", correct = TRUE),
  answer("Agriculture in region 1"),
  answer("Professional in region 5"),
  random_answer_order = TRUE
),
question("Which JobCategory and Region has the __least__ amount of customers?",
  answer("Sales in region 4"),
  answer("Sales in region 5"),
  answer("Agriculture in region 4", correct = TRUE),
  answer("Professional in region 5"),
  random_answer_order = TRUE
)
)
```

### 4. How does HHIncome vary across JobCategory, Region and Gender?

```{r descriptive4, exercise=TRUE, exercise.setup = "prepare-data2"}
# fill in the functions to answer these questions
customer %>%
  group_by() %>% 
  summarize()
```

```{r descriptive4-hint-1}
# first we group by the category of interest (i.e. JobCategory, Region, Gender)
customer %>%
  group_by(JobCategory) %>% 
  summarize()
```

```{r descriptive4-hint-2}
# next we can compute the standard deviation of HHIncome to assess how income
# varies within the category of interest
customer %>%
  group_by(JobCategory) %>% 
  summarize(income_sd = sd(HHIncome))
```

```{r descriptive4-hint-3}
# Last, we rank order the variability
customer %>%
  group_by(JobCategory) %>% 
  summarize(income_sd = sd(HHIncome)) %>%
  arrange(income_sd)
```

```{r descriptive-question4, echo=FALSE}
quiz(caption = "Knowledge Check",
question("Which JobCategory has the __largest__ income variability?",
  answer("Crafts"),
  answer("Sales"),
  answer("Labor", correct = TRUE),
  answer("Professional"),
  random_answer_order = TRUE
),
question("Which Region has the __smallest__ income variability?",
  answer("Sales in region 4"),
  answer("Sales in region 5"),
  answer("Agriculture in region 4", correct = TRUE),
  answer("Professional in region 5"),
  random_answer_order = TRUE
),
question("Is there much difference between Male and Female income variability?",
  answer("No"),
  answer("Yes", correct = TRUE),
  random_answer_order = TRUE,
  correct = "Male incomes have about 20% more variation than females!",
  incorrect = "Male incomes have about 20% more variation than females!"
)
)
```

### 5. Our customers tend to be married, single, or an equal mix? 

### 6. Are married customers more educated than single customers?

### 7. Which age group is most likely to lease an automobile?

### 8. Which age group tends to have the greatest CarValue?

### 9. Which credit card has the highest default rate?

