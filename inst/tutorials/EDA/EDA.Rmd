---
title: "Tutorial 1: Exploratory Data Analysis"
output: 
  learnr::tutorial:
    progressive: true
runtime: shiny_prerendered
---

<script type="text/javascript" async
    src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>



## Introduction

This module provides an opportunity to put into practice many of the techniques discussed in this short course. The goal is to think through the tool(s) youâ€™ll need and use them properly to answer the questions. This case study continues to use the *Customer* data and, although not comprehensive, provides you the opportunity to perform several steps in the analytic process to include:

1. Organizing your files
2. Importing the data
3. Dealing with missing values
4. Understanding numerical and categorical variables through descriptive statistics 
5. Using visualization to understand your data

For this tutorial, I have preloaded the following packages for your use:

```{r setup, include=FALSE}
library(learnr)
library(tidyverse)
library(readxl)

knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE, collapse=TRUE)
```

```{r, eval=FALSE}
library(tidyverse)
library(readxl)
```

## Importing the Data

The first step to any data analysis process is to *get* the data. Assuming our customer data is located in an Excel file titled *CustomerData.xlsx* and located in our current working directory, how would you load it?

```{r import-question1, echo=FALSE}
quiz(caption = "Knowledge Check",
question("How would you read in the names of the spreadsheets in the CustomerData.xlsx file?",
  answer("read_excel('CustomerData.xlsx')"),
  answer("excel_sheets('CustomerData.xlsx')", correct = TRUE),
  answer("read_sheets('CustomerData.xlsx')"),
  allow_retry = TRUE,
  random_answer_order = TRUE,
  correct = "Correct! For this Excel file there are two spreadsheets:  'Metadata' and 'Data'."
),
question("Assuming you want to import the 'Data' spreadsheet from the CustomerData.xlsx file, what is the correct command?",
  answer("read_excel('CustomerData.xlsx', sheet = 'Data')", correct = TRUE),
  answer("read_excel('CustomerData.xlsx')"),
  answer("excel_sheets('CustomerData.xlsx', sheet = 'Data')"),
  answer("read_csv('CustomerData.xlsx', sheet = 'Data')"),
  allow_retry = TRUE,
  random_answer_order = TRUE
)
)
```

For the following exercises I have pre-loaded the customer data and saved it as a data frame named `customer`.  Let's get a basic feel for this `customer` data set by assessing the following:

1. What are the dimensions of this data set?
2. What are the names of all the variables?
3. What type of variables are in this data (i.e. character, integer, double)?

```{r prepare-data, echo=FALSE}
customer <- rbootcamp::customer
```

```{r understand, exercise=TRUE, exercise.setup = "prepare-data"}

```

```{r understand-hint-1}
dim(customer)
```

```{r understand-hint-2}
names(customer)
```

```{r understand-hint-3}
# you can assess the data with glimpse
glimpse(customer)

# or by looping over each column and assessing the type
sapply(customer, typeof)
```

```{r understand-question1, echo=FALSE}
quiz(caption = "Knowledge Check",
question("What are the dimensions of our customer data?",
  answer("5000 x 60"),
  answer("5000 x 59", correct = TRUE),
  answer("5000"),
  answer("59 x 5000"),
  allow_retry = TRUE,
  random_answer_order = TRUE
),
question("What are the names of the first 3 variables?",
  answer("CustomerID, Region, TownSize", correct = TRUE),
  answer("CustomerID, Gender, Age"),
  answer("Region, Gender, Age"),
  answer("CustomerID, Region Age"),
  allow_retry = TRUE,
  random_answer_order = TRUE
),
question("What type of variable is JobCategory?",
  answer("character", correct = TRUE),
  answer("integer"),
  answer("factor"),
  answer("double"),
  allow_retry = TRUE,
  random_answer_order = TRUE
)
)
```

## Dealing with Missing Data

A common task in data analysis is dealing with missing values.  Let's assess missing values in our `customer` data set.   Go ahead and check out:

1. How many missing values are in the data?
2. Which variables contain these missing values?
3. Omit all rows with missing values in them? Now how many observations does your data have?

```{r missing, exercise=TRUE, exercise.setup = "prepare-data"}

```

```{r missing-hint-1}
sum(is.na(customer))
```

```{r missing-hint-2}
colSums(is.na(customer)) %>%
  sort(decreasing = TRUE)
```

```{r missing-hint-3}
customer <- na.omit(customer)

dim(customer)
```

```{r missing-question1, echo=FALSE}
quiz(caption = "Knowledge Check",
question("How many missing values are in this data set?",
  answer("136"),
  answer("124", correct = TRUE),
  answer("98"),
  answer("32"),
  allow_retry = TRUE,
  random_answer_order = TRUE
),
question("How many variables contain missing values?",
  answer("8", correct = TRUE),
  answer("6"),
  answer("4"),
  answer("2"),
  allow_retry = TRUE,
  random_answer_order = TRUE
),
question("How many missing values are in the Gender variable?",
  answer("33", correct = TRUE),
  answer("16"),
  answer("7"),
  answer("2"),
  allow_retry = TRUE,
  random_answer_order = TRUE
),
question("After you remove all missing values, how many rows are in the clean data set?",
  answer("4893", correct = TRUE),
  answer("4888"),
  answer("4918"),
  answer("4617"),
  allow_retry = TRUE,
  random_answer_order = TRUE,
  correct = "That's right!  So by removing missing values we removed 107 customers from our data set."
)
)
```

## Understanding Your Data Through Descriptive Statistics

Descriptive statistics are the first pieces of information used to understand and represent a data set. There goal, in essence, is to describe the main features of numerical and categorical information with simple summaries. Lets perform some descriptive statistics that will help answer the following questions:

### 1. How is average HHIncome distributed across JobCategory? 

The goal is to group our data by *JobCategory* and then compute the mean of the *HHIncome* variable. Rank ordering your data based on the mean income (using `arrange`) will make it easier to interpret the results.

```{r prepare-data2, echo=FALSE}
customer <- na.omit(rbootcamp::customer)
```

```{r descriptive1, exercise=TRUE, exercise.setup = "prepare-data2"}
# fill in these functions to answer the question
customer %>%
  group_by() %>% 
  summarize() %>% 
  arrange()
```

```{r descriptive1-hint-1}
# First, we want to group our data by job category
customer %>%
  group_by(JobCategory) %>% 
  summarize() %>% 
  arrange()
```

```{r descriptive1-hint-2}
# Next, we compute our summary statistic
customer %>%
  group_by(JobCategory) %>% 
  summarize(avg_HHIncome = mean(HHIncome)) %>% 
  arrange()
```

```{r descriptive1-solution}
# Finally, we arrange our summary statistic so we can easily see how the
# job categories rank
customer %>%
  group_by(JobCategory) %>% 
  summarize(avg_HHIncome = mean(HHIncome)) %>% 
  arrange(desc(avg_HHIncome))
```

```{r descriptive-question1, echo=FALSE}
quiz(caption = "Knowledge Check",
question("Which JobCategory has the largest average HHIncome?",
  answer("Crafts"),
  answer("Labor", correct = TRUE),
  answer("Sales"),
  answer("Professional"),
  random_answer_order = TRUE
),
question("Which JobCategory has the smallest average HHIncome?",
  answer("Crafts"),
  answer("Labor"),
  answer("Sales", correct = TRUE),
  answer("Professional"),
  random_answer_order = TRUE
)
)
```


### 2. Is there a large difference in the number of customers in each JobCategory?

Count the number of observations for each *JobCategory* level.

```{r descriptive2, exercise=TRUE, exercise.setup = "prepare-data2"}
# fill in the count function to answer the question
customer %>% 
  count()
```

```{r descriptive2-hint-1}
# We can use count to count the number of observations.
customer %>%
  count(JobCategory)
```


```{r descriptive2-solution}
# We can also include sort = TRUE to sort the output
customer %>%
  count(JobCategory, sort = TRUE)
```

```{r descriptive-question2, echo=FALSE}
quiz(caption = "Knowledge Check",
question("Which JobCategory captures the most customers?",
  answer("Crafts"),
  answer("Sales", correct = TRUE),
  answer("Labor"),
  answer("Professional"),
  random_answer_order = TRUE,
  allow_retry = TRUE
),
question("How many customers are in the *Service* career field?",
  answer("1635"),
  answer("212"),
  answer("610", correct = TRUE),
  answer("452"),
  random_answer_order = TRUE,
  allow_retry = TRUE
)
)
```


### 3. How many customers are in each JobCategory across the regions?

Now count the number of observations for each *JobCategory* and *Region* combination.  Rank ordering your data based on the mean income (using `arrange`) will make it easier to interpret the results. 

```{r descriptive3, exercise=TRUE, exercise.setup = "prepare-data2"}
# fill in the count function to answer the question
customer %>%
  count()
```


```{r descriptive3-hint-1}
# We can inspect the number of earners in each category by region with the following:
customer %>%
  count(JobCategory, Region)
```

```{r descriptive3-hint-2}
# by sorting we can get the categories and regions with the most customers
customer %>%
  count(JobCategory, Region, sort = TRUE)
```

```{r descriptive3-hint-3}
# and we can add arrange to identify the categories and regions with the least 
# customers
customer %>%
  count(JobCategory, Region) %>%
  arrange(n)
```

```{r descriptive-question3, echo=FALSE}
quiz(caption = "Knowledge Check",
question("Which JobCategory and Region captures the most customers?",
  answer("Sales in region 4"),
  answer("Sales in region 5", correct = TRUE),
  answer("Agriculture in region 1"),
  answer("Professional in region 5"),
  random_answer_order = TRUE,
  allow_retry = TRUE
),
question("Which JobCategory and Region has the __least__ amount of customers?",
  answer("Sales in region 4"),
  answer("Sales in region 5"),
  answer("Agriculture in region 4", correct = TRUE),
  answer("Professional in region 5"),
  random_answer_order = TRUE,
  allow_retry = TRUE
)
)
```

### 4. How does HHIncome vary across JobCategory, Region and Gender?

The goal is to group our data by *JobCategory* and then compute the standard deviation of the *HHIncome* variable.  You can compute the standard deviation of variable *x* by using the function `sd(x)`. 

```{r descriptive4, exercise=TRUE, exercise.setup = "prepare-data2"}
# fill in the functions to answer these questions
customer %>%
  group_by() %>% 
  summarize()
```

```{r descriptive4-hint-1}
# first we group by the category of interest (i.e. JobCategory, Region, Gender)
customer %>%
  group_by(JobCategory) %>% 
  summarize()
```

```{r descriptive4-hint-2}
# next we can compute the standard deviation of HHIncome to assess how income
# varies within the category of interest
customer %>%
  group_by(JobCategory) %>% 
  summarize(income_sd = sd(HHIncome))
```

```{r descriptive4-hint-3}
# Last, we rank order the variability
customer %>%
  group_by(JobCategory) %>% 
  summarize(income_sd = sd(HHIncome)) %>%
  arrange(income_sd)
```

```{r descriptive-question4, echo=FALSE}
quiz(caption = "Knowledge Check",
question("Which JobCategory has the __largest__ income variability?",
  answer("Crafts"),
  answer("Sales"),
  answer("Labor", correct = TRUE),
  answer("Professional"),
  random_answer_order = TRUE,
  allow_retry = TRUE
),
question("Which Region has the __smallest__ income variability?",
  answer("4"),
  answer("5"),
  answer("2", correct = TRUE),
  answer("1"),
  random_answer_order = TRUE,
  allow_retry = TRUE
),
question("Is there much difference between Male and Female income variability?",
  answer("No"),
  answer("Yes", correct = TRUE),
  random_answer_order = TRUE,
  correct = "Male incomes have about 20% more variation than females!",
  incorrect = "Male incomes have about 20% more variation than females!"
)
)
```

### 5. What percentage of our customers are married vs. unmarried? 

Compute the percentage of customers that are married vs. unmarried.  Note that the variable of interest here is *MarritalStatus*.  This will require you to count the number of observations in each level of *MarritalStatus* and then use `mutate` to create a new variable that computes the percentage.

```{r descriptive5, exercise=TRUE, exercise.setup = "prepare-data2"}
# fill in the functions to answer these questions
customer %>%
  count() %>% 
  mutate()
```

```{r descriptive5-hint-1}
# first we count the number of observations that are married vs. unmarried
customer %>%
  count(MaritalStatus) %>% 
  mutate()
```

```{r descriptive5-hint-2}
# next we use mutate to create a new variable that computes the percent of each
customer %>%
  count(MaritalStatus) %>% 
  mutate(pct = n / sum(n))
```


```{r descriptive-question5, echo=FALSE}
quiz(caption = "Knowledge Check",
 question("Are the majority of our customers married or unmarried?",
  answer("Married"),
  answer("Unmarried", correct = TRUE),
  random_answer_order = TRUE,
  allow_retry = TRUE
),
question("How many customers are married?",
  answer("2346"),
  answer("2599"),
  answer("2401", correct = TRUE),
  random_answer_order = TRUE,
  allow_retry = TRUE
),
question("What percentage of our customers are married?",
  answer("44%"),
  answer("53%"),
  answer("48%", correct = TRUE),
  answer("56%"),
  random_answer_order = TRUE,
  allow_retry = TRUE
)
)
```

### 6. Are married customers more educated than single customers?

The goal is to group our data by *MaritalStatus* and then compute the average education in years (*EducationYears* variable).  For this exercise, compute the `mean` and `median` education in years for married vs. unmarried customers.

```{r descriptive6, exercise=TRUE, exercise.setup = "prepare-data2"}
# fill in the functions to answer these questions
customer %>%
  group_by() %>% 
  summarize()
```

```{r descriptive6-hint-1}
# first we group our data based on marital status
customer %>%
  group_by(MaritalStatus) %>% 
  summarize()
```

```{r descriptive6-hint-2}
# next we compute the mean and median education levels
customer %>%
  group_by(MaritalStatus) %>% 
  summarize(med_Ed = mean(EducationYears),
            mean_Ed = mean(EducationYears))
```


```{r descriptive-question6, echo=FALSE}
quiz(caption = "Knowledge Check",
 question("What is the median education level for unmarried customers?",
  answer("13.2 years"),
  answer("15.1 years"),
  answer("14.1 years"),
  answer("14.6 years", correct = TRUE),
  random_answer_order = TRUE,
  allow_retry = TRUE,
  correct = "The mean and median education levels are about 14.5 years for both married and unmarried customers."
),
 question("What is the mean education level for married customers?",
  answer("13.9 years"),
  answer("15.1 years"),
  answer("14.1 years"),
  answer("14.5 years", correct = TRUE),
  random_answer_order = TRUE,
  allow_retry = TRUE
),
question("Are the education levels about the same for married and unmarried?",
  answer("No"),
  answer("Yes", correct = TRUE),
  random_answer_order = TRUE,
  allow_retry = TRUE,
  correct = "The mean and median education levels are about 14.5 years for both married and unmarried customers."
)
)
```

### 7. Which ages are most likely to lease an automobile?

To answer this question, perform the following sequence:

1. count the number of observations by *Age* and *CarOwnership*
2. create a new variable that computes the percentage of car leasers
3. filter for only those customers that lease
4. arrange your percent leasers variable in descending order

```{r descriptive7, exercise=TRUE, exercise.setup = "prepare-data2"}
# fill in the functions to answer these questions
customer %>%
  count() %>%
  mutate() %>% 
  filter() %>% 
  arrange()
```

```{r descriptive7-hint-1}
# first we count our data by age and car ownership
customer %>%
  count(Age, CarOwnership) %>%
  mutate() %>% 
  filter() %>% 
  arrange()
```

```{r descriptive7-hint-2}
# next we compute the percentage of leasers versus non leasing activities
# note how I use the round() to round my percents to 2 decimals
customer %>%
  count(Age, CarOwnership) %>%
  mutate(pct_lease = round(n / sum(n), 2)) %>% 
  filter() %>% 
  arrange()
```

```{r descriptive7-hint-3}
# then we can filter for just those customers that lease
customer %>%
  count(Age, CarOwnership) %>%
  mutate(pct_lease = round(n / sum(n), 2)) %>% 
  filter(CarOwnership == "Lease") %>% 
  arrange()
```

```{r descriptive7-solution}
# and lastly we rank order the data based on percent lease
customer %>%
  count(Age, CarOwnership) %>%
  mutate(pct_lease = round(n / sum(n), 2)) %>% 
  filter(CarOwnership == "Lease") %>% 
  arrange(desc(pct_lease))
```


```{r descriptive-question7, echo=FALSE}
quiz(caption = "Knowledge Check",
 question("What age has the highest percentage of leasers?",
  answer("39 years"),
  answer("22 years"),
  answer("65 years"),
  answer("79", correct = TRUE),
  random_answer_order = TRUE,
  allow_retry = TRUE
),
 question("What age has the lowest percentage of leasers?",
  answer("39 years", correct = TRUE),
  answer("22 years"),
  answer("65 years"),
  answer("79"),
  random_answer_order = TRUE,
  allow_retry = TRUE
)
)
```

### 8. Which age group tends to have the greatest car value?

The goal is to find the top 5 age groups with the largest average *CarValue*.  You can accomplish this by grouping the data by *Age*, computing the mean *CarValue*, and then using the `top_n()` function to find the top 5.

```{r descriptive8, exercise=TRUE, exercise.setup = "prepare-data2"}
# fill in the functions to answer these questions
customer %>%
  group_by() %>%
  summarize() %>% 
  top_n(5)
```

```{r descriptive8-hint-1}
# first we group our data by age
customer %>%
  group_by(Age) %>%
  summarize() %>% 
  top_n(5)
```

```{r descriptive8-hint-2}
# next we compute the mean of the CarValue variable
customer %>%
  group_by(Age) %>%
  summarize(avg_value = mean(CarValue)) %>% 
  top_n(5)
```


```{r descriptive8-solution}
customer %>%
  group_by(Age) %>%
  summarize(avg_value = mean(CarValue)) %>% 
  top_n(5)
```


```{r descriptive-question8, echo=FALSE}
quiz(caption = "Knowledge Check",
 question("Which age has the highest average car value?",
  answer("67 years"),
  answer("22 years"),
  answer("52 years"),
  answer("57", correct = TRUE),
  random_answer_order = TRUE,
  allow_retry = TRUE,
  incorrect = "Look closely.  The top_n function keeps the data ordered by age but identifies those ages with the top 5 largest mean car values."
),
 question("What is the average car value for 52 year olds?",
  answer("$37,389", correct = TRUE),
  answer("$32,450"),
  answer("$30,111"),
  answer("$36,986"),
  random_answer_order = TRUE,
  allow_retry = TRUE
)
)
```

### 9. Which credit card has the highest default rate?

The goal is to find the top 5 age groups with the largest average *CarValue*.  You can accomplish this by grouping the data by *Age*, computing the mean *CarValue*, and then using the `top_n()` function to find the top 5.

```{r descriptive9, exercise=TRUE, exercise.setup = "prepare-data2"}
# fill in the functions to answer these questions
customer %>%
  group_by() %>%
  summarize() %>% 
  top_n(5)
```

```{r descriptive9-hint-1}
# first we group our data by age
customer %>%
  group_by(Age) %>%
  summarize() %>% 
  top_n(5)
```

```{r descriptive9-hint-2}
# next we compute the mean of the CarValue variable
customer %>%
  group_by(Age) %>%
  summarize(avg_value = mean(CarValue)) %>% 
  top_n(5)
```


```{r descriptive9-solution}
customer %>%
  group_by(Age) %>%
  summarize(avg_value = mean(CarValue)) %>% 
  top_n(5)
```


```{r descriptive-question9, echo=FALSE}
quiz(caption = "Knowledge Check",
 question("Which credit card has the highest loan default?",
  answer("Visa"),
  answer("Disc"),
  answer("AMEX"),
  answer("Othe", correct = TRUE),
  random_answer_order = TRUE,
  allow_retry = TRUE
),
 question("Which credit card has the secondhighest loan default?",
  answer("Visa"),
  answer("Disc"),
  answer("AMEX", correct = TRUE),
  answer("Othe"),
  random_answer_order = TRUE,
  allow_retry = TRUE
),
 question("What is the loan default rate for Visa customers?",
  answer("22%"),
  answer("24%"),
  answer("23%", correct = TRUE),
  answer("29%"),
  random_answer_order = TRUE,
  allow_retry = TRUE
)
)
```

## Understanding Your Data Through Visualization

We can answer the same questions in the previous section by using `ggplot2` to visualize our data.

### 1. How is average HHIncome distributed across JobCategory? 

In the last section we grouped our data by *JobCategory* and then computed the mean of the *HHIncome* variable with the below code.  Can you fill in the `ggplot` code to visualize the results?  You only need to fill in the `x` and `y` variables.  `geom_col()` will plot the required bar chart.

```{r viz1, exercise=TRUE, exercise.setup = "prepare-data2"}
df <- customer %>%
  group_by(JobCategory) %>% 
  summarize(avg_HHIncome = mean(HHIncome))

ggplot(data = df, aes(x =  , y =  )) +
  geom_col()
```

```{r viz1-hint-1}
df <- customer %>%
  group_by(JobCategory) %>% 
  summarize(avg_HHIncome = mean(HHIncome))

ggplot(data = df, aes(x = JobCategory, y =  avg_HHIncome)) +
  geom_col()
```

```{r viz1-hint-2}
# we can even reorder our x-axis based on the income levels
ggplot(data = df, aes(x = reorder(JobCategory, -avg_HHIncome), y =  avg_HHIncome)) +
  geom_col()
```

### 2. Is there a large difference in the number of customers in each JobCategory?

If we just want to count the number of observations for each *JobCategory* level, we can do this easily with a bar chart (`geom_bar`).

Can you fill in the `ggplot` code to visualize the results?  You only need to fill in the `data` and `x` arguments (remember, not all `geom`s require an `x` *and* `y` variable).  `geom_bar()` will take care of the rest.

```{r viz2, exercise=TRUE, exercise.setup = "prepare-data2"}
ggplot(data = , aes(x =  )) +
  geom_bar()
```

```{r viz2-hint-1}
ggplot(data = customer, aes(x = )) +
  geom_bar()
```

```{r viz2-hint-2}
ggplot(data = customer, aes(x = JobCategory)) +
  geom_bar()
```

### 3. How many customers are in each JobCategory across the regions?

What if we want to look at the number of customers for each *JobCategory* __and__ *Region* combination.  We can do this by *facetting* with `facet_wrap()`.  See if you can complete the ggplot code to do this.  Hint, you just need to add a variable to `facet_wrap()`.

```{r viz3, exercise=TRUE, exercise.setup = "prepare-data2"}
ggplot(data = customer, aes(x = JobCategory)) +
  geom_bar() +
  facet_wrap()
```

```{r viz3-hint-1}
ggplot(data = customer, aes(x = JobCategory)) +
  geom_bar() +
  facet_wrap(~ Region)
```

### 4. How does HHIncome vary across JobCategory, Region and Gender?

In the last section we answered this question by computing the standard deviation of *HHIncome* across each variable of concern.  Using a histogram (`geom_histogram`) and facetting will help us understand this visually. Complete this code by:

1. Adding the appropriate `x` variable
2. Adding the appropriate `geom_`
3. Adding the `facet_wrap`

```{r viz4, exercise=TRUE, exercise.setup = "prepare-data2"}
ggplot(data = customer, aes(x = )) +
  
  
```

```{r viz4-hint-1}
# assess how HHIncome is distributed across JobCategory
ggplot(data = customer, aes(x = HHIncome)) +
  geom_histogram() +
  facet_wrap(~ JobCategory)
```

```{r viz4-hint-2}
# assess how HHIncome is distributed across JobCategory
ggplot(data = customer, aes(x = HHIncome)) +
  geom_histogram() +
  facet_wrap(~ Region)
```

```{r viz4-hint-3}
# assess how HHIncome is distributed across JobCategory
ggplot(data = customer, aes(x = HHIncome)) +
  geom_histogram() +
  facet_wrap(~ Gender)
```

Given that income is so skewed, see if you can adjust the x-axis scale to be on a logarithmic scale.  Hint, you only need to add a `scale_x_` function to the following code.

```{r viz4a, exercise=TRUE, exercise.setup = "prepare-data2"}
ggplot(data = customer, aes(x = HHIncome)) +
  geom_histogram() +
  facet_wrap(~ Gender)
```

```{r viz4a-hint-1}
ggplot(data = customer, aes(x = HHIncome)) +
  geom_histogram() +
  facet_wrap(~ Gender) +
  scale_x_log10()
```

### 5. What percentage of our customers are married vs. unmarried? 

In the last section we computed the percentage of married vs. unmarried customers with the following code.  Can you pipe (`%>%`) the results of this code directly into `ggplot` and plot a bar chart to illustrate the results?

```{r viz5, exercise=TRUE, exercise.setup = "prepare-data2"}
customer %>%
  count(MaritalStatus) %>% 
  mutate(pct = n / sum(n))
```

```{r viz5-hint-1}
# first you need to pipe it into ggplot and now you just need to add the 
# appropriate geom (hint: geom_col)
customer %>%
  count(MaritalStatus) %>% 
  mutate(pct = n / sum(n)) %>%
  ggplot(aes(x = MaritalStatus, y = pct))
```

```{r viz5-hint-2}
customer %>%
  count(MaritalStatus) %>% 
  mutate(pct = n / sum(n)) %>%
  ggplot(aes(x = MaritalStatus, y = pct)) +
  geom_col()
```

That's right!  Now see how the final plot had its y-axis in decimal form even though they represent percentages.  See if you can add the right arguments in the `scale_y_continuous()` function below to change this axis to be formatted as percentages.

```{r viz5a, exercise=TRUE, exercise.setup = "prepare-data2"}
customer %>%
  count(MaritalStatus) %>% 
  mutate(pct = n / sum(n)) %>%
  ggplot(aes(x = MaritalStatus, y = pct)) +
  geom_col() +
  scale_y_continuous()
```

```{r viz5a-solution}
customer %>%
  count(MaritalStatus) %>% 
  mutate(pct = n / sum(n)) %>%
  ggplot(aes(x = MaritalStatus, y = pct)) +
  geom_col() +
  scale_y_continuous(labels = scales::percent)
```

### 6. Are married customers more educated than single customers?

To answer this questions, in the last section we simply computed the mean and median.  Here, let's compare the distribution with a density plot.  In this case, we want to create a density plot of the *EducationYears* variable but overlay the distribution of married vs. unmarried.  See if you can fill in the arguments for:

- `x` which is the variable we want to see the distribution of
- `fill` which will color the distributions based on marital status
- `alpha` which accepts values 0-1 and controls the opacity

```{r viz6, exercise=TRUE, exercise.setup = "prepare-data2"}
ggplot(customer, aes(x = , fill = )) +
  geom_density(alpha = )
```

```{r viz6-hint-1}
# We want to see the distribution of education years
ggplot(customer, aes(x = EducationYears, fill = )) +
  geom_density(alpha = )
```

```{r viz6-hint-2}
# we use fill to compare the distributions across the marital status categories
ggplot(customer, aes(x = EducationYears, fill = MaritalStatus)) +
  geom_density(alpha = )
```

```{r viz6-hint-3}
# and we use alpha to make the distributions transparent which allows us to see
# how they overlap
ggplot(customer, aes(x = EducationYears, fill = MaritalStatus)) +
  geom_density(alpha = .5)
```


### 7. How do monthly expenditures relate to debt?

Now we'll detour from some of the previously asked questions and inject a new one.  Let's assess how credit card debt (*CreditDebt*) and income (*HHIncome*) are related.  First, fill in the code below to assess the relationships between these two variables across all customers.

```{r viz7, exercise=TRUE, exercise.setup = "prepare-data2"}
ggplot(customer, aes(x = , y = )) +
  geom_point()
```

```{r viz7-solution}
ggplot(customer, aes(x = HHIncome, y = CreditDebt)) +
  geom_point()
```

###

This isn't a very revealing plot; however, financial data is often heavily skewed.  Can you adjust the x and y axes to be on logarithmic scale?

```{r viz7b, exercise=TRUE, exercise.setup = "prepare-data2"}
ggplot(customer, aes(x = HHIncome, y = CreditDebt)) +
  geom_point()
```

```{r viz7b-solution}
ggplot(customer, aes(x = HHIncome, y = CreditDebt)) +
  geom_point() +
  scale_x_log10() +
  scale_y_log10()
```

###

We see that when we transform our axes, a stronger relationship emerges.  Let's add a linear relationship line with `geom_smooth` to illustrate the relationship.

```{r viz7c, exercise=TRUE, exercise.setup = "prepare-data2"}
ggplot(customer, aes(x = HHIncome, y = CreditDebt)) +
  geom_point() +
  scale_x_log10() +
  scale_y_log10()
```

```{r viz7c-solution}
ggplot(customer, aes(x = HHIncome, y = CreditDebt)) +
  geom_point() +
  scale_x_log10() +
  scale_y_log10() +
  geom_smooth(method = "lm")
```

###

Let's expand on this and assess if those who have defaulted on loans tend to have a higher credit debt.  Naturally, we would assume yes but let's see what the data says.  Go ahead and build onto the below code to allow you to compare this relationship across loan defaulters (*LoanDefault*).  You could do this by coloring, facetting, etc.

```{r viz7d, exercise=TRUE, exercise.setup = "prepare-data2"}
ggplot(customer, aes(x = HHIncome, y = CreditDebt)) +
  geom_point() +
  scale_x_log10() +
  scale_y_log10() +
  geom_smooth(method = "lm")
```

```{r viz7d-hint-1}
# this option facets by LoanDefault
ggplot(customer, aes(x = HHIncome, y = CreditDebt)) +
  geom_point() +
  scale_x_log10() +
  scale_y_log10() +
  geom_smooth(method = "lm") +
  facet_wrap(~ LoanDefault)
```

```{r viz7d-hint-2}
# this option colors by LoanDefault and allows us to see the difference in the
# relationship between defaulters and non-defaulters
ggplot(customer, aes(x = HHIncome, y = CreditDebt, color = LoanDefault)) +
  geom_point(alpha = .10) +
  scale_x_log10() +
  scale_y_log10() +
  geom_smooth(method = "lm")
```

## Understanding Relationships



